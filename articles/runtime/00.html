<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>编译 Runtime 源码 （objc4-750.1） | 周小可</title>
    <meta name="description" content="实践不仅是检验真理的标准，而且是唯一的标准。">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.4a9e7301.css" as="style"><link rel="preload" href="/blog/assets/js/app.a54d2909.js" as="script"><link rel="preload" href="/blog/assets/js/2.fd76eafa.js" as="script"><link rel="preload" href="/blog/assets/js/4.068bd1c5.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.15308436.js"><link rel="prefetch" href="/blog/assets/js/11.a771847c.js"><link rel="prefetch" href="/blog/assets/js/12.feaf4627.js"><link rel="prefetch" href="/blog/assets/js/13.e37a4c0b.js"><link rel="prefetch" href="/blog/assets/js/14.de6f1bc3.js"><link rel="prefetch" href="/blog/assets/js/15.4427f88c.js"><link rel="prefetch" href="/blog/assets/js/16.9d3218d0.js"><link rel="prefetch" href="/blog/assets/js/17.d9d07dad.js"><link rel="prefetch" href="/blog/assets/js/18.c4b7480b.js"><link rel="prefetch" href="/blog/assets/js/19.4f9f264a.js"><link rel="prefetch" href="/blog/assets/js/20.06a48f5c.js"><link rel="prefetch" href="/blog/assets/js/21.4257293a.js"><link rel="prefetch" href="/blog/assets/js/22.85e5ef53.js"><link rel="prefetch" href="/blog/assets/js/23.0dfc6d99.js"><link rel="prefetch" href="/blog/assets/js/24.a433853c.js"><link rel="prefetch" href="/blog/assets/js/25.97f2b81e.js"><link rel="prefetch" href="/blog/assets/js/26.532cd082.js"><link rel="prefetch" href="/blog/assets/js/27.96db6f2e.js"><link rel="prefetch" href="/blog/assets/js/28.a1f6a8bc.js"><link rel="prefetch" href="/blog/assets/js/29.b2c2bd91.js"><link rel="prefetch" href="/blog/assets/js/3.98209718.js"><link rel="prefetch" href="/blog/assets/js/30.4ab75552.js"><link rel="prefetch" href="/blog/assets/js/31.a263582b.js"><link rel="prefetch" href="/blog/assets/js/32.434785d8.js"><link rel="prefetch" href="/blog/assets/js/33.73f26596.js"><link rel="prefetch" href="/blog/assets/js/34.c4fb3767.js"><link rel="prefetch" href="/blog/assets/js/35.e8ff9422.js"><link rel="prefetch" href="/blog/assets/js/36.0252fde3.js"><link rel="prefetch" href="/blog/assets/js/37.1e89f062.js"><link rel="prefetch" href="/blog/assets/js/38.d84daf6a.js"><link rel="prefetch" href="/blog/assets/js/39.9bf7e592.js"><link rel="prefetch" href="/blog/assets/js/40.9d39ea55.js"><link rel="prefetch" href="/blog/assets/js/41.42a663a1.js"><link rel="prefetch" href="/blog/assets/js/42.3a751d2f.js"><link rel="prefetch" href="/blog/assets/js/43.3a335356.js"><link rel="prefetch" href="/blog/assets/js/44.7d01f77e.js"><link rel="prefetch" href="/blog/assets/js/45.94380ee0.js"><link rel="prefetch" href="/blog/assets/js/46.c3daaae4.js"><link rel="prefetch" href="/blog/assets/js/47.0ef93bcd.js"><link rel="prefetch" href="/blog/assets/js/48.5b1a24b8.js"><link rel="prefetch" href="/blog/assets/js/49.c39c7fef.js"><link rel="prefetch" href="/blog/assets/js/5.bb18b958.js"><link rel="prefetch" href="/blog/assets/js/50.43f38f52.js"><link rel="prefetch" href="/blog/assets/js/51.fb3a6504.js"><link rel="prefetch" href="/blog/assets/js/52.d09c3b70.js"><link rel="prefetch" href="/blog/assets/js/53.06f6490b.js"><link rel="prefetch" href="/blog/assets/js/54.437f5d1a.js"><link rel="prefetch" href="/blog/assets/js/55.eb0681e9.js"><link rel="prefetch" href="/blog/assets/js/56.089548ed.js"><link rel="prefetch" href="/blog/assets/js/57.d545c4fe.js"><link rel="prefetch" href="/blog/assets/js/58.70be975f.js"><link rel="prefetch" href="/blog/assets/js/59.eebe4e88.js"><link rel="prefetch" href="/blog/assets/js/6.4d3dd8e5.js"><link rel="prefetch" href="/blog/assets/js/60.91b3ed77.js"><link rel="prefetch" href="/blog/assets/js/61.71e6c721.js"><link rel="prefetch" href="/blog/assets/js/62.28e384bf.js"><link rel="prefetch" href="/blog/assets/js/63.6646438b.js"><link rel="prefetch" href="/blog/assets/js/64.302d43d4.js"><link rel="prefetch" href="/blog/assets/js/65.271d4d28.js"><link rel="prefetch" href="/blog/assets/js/66.90a8840e.js"><link rel="prefetch" href="/blog/assets/js/67.1ad437d0.js"><link rel="prefetch" href="/blog/assets/js/68.90855765.js"><link rel="prefetch" href="/blog/assets/js/69.f6f5adc6.js"><link rel="prefetch" href="/blog/assets/js/7.481a6611.js"><link rel="prefetch" href="/blog/assets/js/70.3853662a.js"><link rel="prefetch" href="/blog/assets/js/71.98d8eeee.js"><link rel="prefetch" href="/blog/assets/js/72.fff2c9b2.js"><link rel="prefetch" href="/blog/assets/js/73.3d888aa9.js"><link rel="prefetch" href="/blog/assets/js/74.f4c59cfe.js"><link rel="prefetch" href="/blog/assets/js/75.39a7ef7e.js"><link rel="prefetch" href="/blog/assets/js/76.9faa10ae.js"><link rel="prefetch" href="/blog/assets/js/77.ac1b1239.js"><link rel="prefetch" href="/blog/assets/js/78.614fab51.js"><link rel="prefetch" href="/blog/assets/js/79.91b89113.js"><link rel="prefetch" href="/blog/assets/js/8.a7cdda78.js"><link rel="prefetch" href="/blog/assets/js/80.aaa67e21.js"><link rel="prefetch" href="/blog/assets/js/81.1e302fb8.js"><link rel="prefetch" href="/blog/assets/js/82.fce58955.js"><link rel="prefetch" href="/blog/assets/js/83.36cc12dd.js"><link rel="prefetch" href="/blog/assets/js/84.512f6776.js"><link rel="prefetch" href="/blog/assets/js/85.b32496e1.js"><link rel="prefetch" href="/blog/assets/js/86.f741c1ec.js"><link rel="prefetch" href="/blog/assets/js/87.29d27f1f.js"><link rel="prefetch" href="/blog/assets/js/88.3b0964ad.js"><link rel="prefetch" href="/blog/assets/js/89.12851ce5.js"><link rel="prefetch" href="/blog/assets/js/9.48986d07.js"><link rel="prefetch" href="/blog/assets/js/90.2f222f77.js"><link rel="prefetch" href="/blog/assets/js/91.edf5550b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.4a9e7301.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">周小可</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">iOS</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/gcd/" class="nav-link">GCD</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/locks/" class="nav-link">iOS中的锁</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/performance-optimization/" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/responder/" class="nav-link">事件响应</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/image_decode/" class="nav-link">图片编解码</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/nshashtable-nsmaptable/" class="nav-link">NSHashTable 和 NSMapTable</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/dttext/" class="nav-link">图文混排与 DTCoreText</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/mvvm/" class="nav-link">MVVM 实战</a></li><li class="dropdown-item"><!----> <a href="https://github.com/hnxczk/InfiniteTree" target="_blank" rel="noopener noreferrer" class="nav-link external">
  InfiniteTree
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/hnxczk/ScrollViewAutoAdjust" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ScrollViewAutoAdjust
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/blog/articles/instruments/" class="nav-link">Instruments 分析</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/note/" class="nav-link">笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/mdn/" class="nav-link">MDN 学习笔记</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/02/" class="nav-link">JavaScript 类型</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/03/" class="nav-link">JavaScript 对象和原型链</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/05/" class="nav-link">JavaScript 执行上下文和执行栈</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/06/" class="nav-link">JavaScript 作用域链与闭包</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/head-first-design-pattern/" class="nav-link">Head First 设计模式</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/Graphic-Design-Patterns/" class="nav-link">图说设计模式</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-algorithm/" class="nav-link">极客时间-算法</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/" class="nav-link">极客时间-重学前端</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/network-study/" class="nav-link">极客时间-网络</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">源码解析</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/sd/" class="nav-link">SDWebImage</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/runtime/index/" class="nav-link">Runtime</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/hash-map/" class="nav-link">哈希表</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/search/" class="nav-link">查找</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/algorithm-interview/" class="nav-link">面试遇到的算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/networking/" class="nav-link">哈希表</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/http-https/" class="nav-link">HTTP与HTTPS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/ios-coding-style/" class="nav-link">iOS 代码规范</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/ios-code-review/" class="nav-link">iOS 代码审核</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/configura/" class="nav-link">多环境配置</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/ios-app-on-line/" class="nav-link">开发者账号相关</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/uml/" class="nav-link">UML类图</a></li></ul></div></div> <a href="https://github.com/hnxczk/hnxczk.github.io.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">iOS</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/gcd/" class="nav-link">GCD</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/locks/" class="nav-link">iOS中的锁</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/performance-optimization/" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/responder/" class="nav-link">事件响应</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/image_decode/" class="nav-link">图片编解码</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/nshashtable-nsmaptable/" class="nav-link">NSHashTable 和 NSMapTable</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/dttext/" class="nav-link">图文混排与 DTCoreText</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/mvvm/" class="nav-link">MVVM 实战</a></li><li class="dropdown-item"><!----> <a href="https://github.com/hnxczk/InfiniteTree" target="_blank" rel="noopener noreferrer" class="nav-link external">
  InfiniteTree
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/hnxczk/ScrollViewAutoAdjust" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ScrollViewAutoAdjust
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/blog/articles/instruments/" class="nav-link">Instruments 分析</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/note/" class="nav-link">笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/mdn/" class="nav-link">MDN 学习笔记</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/02/" class="nav-link">JavaScript 类型</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/03/" class="nav-link">JavaScript 对象和原型链</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/05/" class="nav-link">JavaScript 执行上下文和执行栈</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/06/" class="nav-link">JavaScript 作用域链与闭包</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/head-first-design-pattern/" class="nav-link">Head First 设计模式</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/Graphic-Design-Patterns/" class="nav-link">图说设计模式</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-algorithm/" class="nav-link">极客时间-算法</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/" class="nav-link">极客时间-重学前端</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/network-study/" class="nav-link">极客时间-网络</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">源码解析</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/sd/" class="nav-link">SDWebImage</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/runtime/index/" class="nav-link">Runtime</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/hash-map/" class="nav-link">哈希表</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/search/" class="nav-link">查找</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/algorithm-interview/" class="nav-link">面试遇到的算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/networking/" class="nav-link">哈希表</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/http-https/" class="nav-link">HTTP与HTTPS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/ios-coding-style/" class="nav-link">iOS 代码规范</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/ios-code-review/" class="nav-link">iOS 代码审核</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/configura/" class="nav-link">多环境配置</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/ios-app-on-line/" class="nav-link">开发者账号相关</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/uml/" class="nav-link">UML类图</a></li></ul></div></div> <a href="https://github.com/hnxczk/hnxczk.github.io.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>编译 Runtime 源码 （objc4-750.1）</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/articles/runtime/00.html#如何查看开源网站" class="sidebar-link">如何查看开源网站</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/articles/runtime/00.html#下载源码" class="sidebar-link">下载源码</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/articles/runtime/00.html#解压" class="sidebar-link">解压</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/articles/runtime/00.html#编译" class="sidebar-link">编译</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/articles/runtime/00.html#_1-创建-include-文件夹并设置-header-search-paths" class="sidebar-link">1. 创建 include 文件夹并设置 Header Search Paths</a></li><li class="sidebar-sub-header"><a href="/blog/articles/runtime/00.html#_2-开始编译" class="sidebar-link">2. 开始编译</a></li><li class="sidebar-sub-header"><a href="/blog/articles/runtime/00.html#警告的处理" class="sidebar-link">警告的处理</a></li></ul></li><li><a href="/blog/articles/runtime/00.html#调试" class="sidebar-link">调试</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/articles/runtime/00.html#统计" class="sidebar-link">统计</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/articles/runtime/00.html#杂项" class="sidebar-link">杂项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/articles/runtime/00.html#_1-import-没有提示" class="sidebar-link">1. import 没有提示</a></li><li class="sidebar-sub-header"><a href="/blog/articles/runtime/00.html#_2-某些库的头文件无法找到" class="sidebar-link">2. 某些库的头文件无法找到</a></li></ul></li><li><a href="/blog/articles/runtime/00.html#参考" class="sidebar-link">参考</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="编译-runtime-源码-（objc4-750-1）"><a href="#编译-runtime-源码-（objc4-750-1）" aria-hidden="true" class="header-anchor">#</a> 编译 Runtime 源码 （objc4-750.1）</h1> <p><a href="https://github.com/hnxczk/objc4-750.1" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>有一个编译好的，对下面内容不感兴趣的可以直接拿走用。（提示： 这里和后面所用的源码都是 x86 平台的）。</p> <h2 id="如何查看开源网站"><a href="#如何查看开源网站" aria-hidden="true" class="header-anchor">#</a> 如何查看开源网站</h2> <p><a href="https://opensource.apple.com/" target="_blank" rel="noopener noreferrer">开源网站首页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ol><li><p>这里面有许多开源的项目，以及开源项目对应的系统版本。因此需要先选择某个版本的系统来查看对应的开源项目。</p> <div class="language- extra-class"><pre class="language-text"><code>https://opensource.apple.com/
</code></pre></div><p><img src="/blog/assets/img/18.614c77fd.jpg" alt=""></p></li> <li><p>由于 iOS 的开源项目较少，因此我们选择最新的 mac OS 10.14.1 版本。</p> <div class="language- extra-class"><pre class="language-text"><code>https://opensource.apple.com/release/macos-10141.html
</code></pre></div></li> <li><p>Runtime 对应的开源项目是 objc4 这个项目，通过 <code>command + F</code> 来搜索点击右侧的下载按钮就能下载下来。下面就是下载地址。</p> <div class="language- extra-class"><pre class="language-text"><code>https://opensource.apple.com/tarballs/objc4/objc4-750.1.tar.gz
</code></pre></div><p><img src="/blog/assets/img/19.3a3d9df7.jpg" alt=""></p></li> <li><p>如果你没有点击下载按钮而是点击了左侧的项目，就会跳转到源码目录</p> <div class="language- extra-class"><pre class="language-text"><code>https://opensource.apple.com/source/objc4/objc4-750.1/
</code></pre></div><p><img src="/blog/assets/img/22.e17c47dd.jpg" alt=""></p></li> <li><p>通过对比 3 和 4 的地址我们可以看出来地址中的 <code>tarballs</code> 和 <code>source</code> 决定了这个地址是项目的目录还是项目的压缩包。查找其他缺失的头文件所属的项目会用到这个技巧。</p> <p><img src="/blog/assets/img/20.eb0658f1.jpg" alt=""></p> <p><img src="/blog/assets/img/21.2664d4de.jpg" alt=""></p></li> <li><p>通过下面的地址可以查找到所有版本的 objc4 的项目，我们可以看出来数值越大的版本越新。但是也不是版本越高越好，某些时候新版本会缺失一些文件，应该是移去其他项目或者私有化了。这时候可以使用低版本来替换。</p> <div class="language- extra-class"><pre class="language-text"><code>https://opensource.apple.com/source/objc4/
</code></pre></div></li></ol> <h2 id="下载源码"><a href="#下载源码" aria-hidden="true" class="header-anchor">#</a> 下载源码</h2> <p>按照上面所说的我们下载了 <code>objc4-750.1</code> 的压缩包。解压之后编译就会报很多的错误，其中大部分都是缺少头文件，我们需要从其他的开源项目中找到它们。下面是需要下载的开源项目列表。</p> <ol><li>objc4-750.1.tar.gz (Runtime 源码)</li> <li>Libc-825.40.1.tar.gz （不是最新的，最新的有些头文件找不到）</li> <li>dyld-551.4.tar.gz （不是最新的）</li> <li>launchd-842.92.1.tar.gz (这个在 source 目录下找不到，需要在 tarballs 目录下查找)</li> <li>libauto-187.tar.gz</li> <li>libclosure-73.tar.gz</li> <li>libdispatch-1008.200.78.tar.gz</li> <li>libplatform-177.200.16.tar.gz</li> <li>xnu-4903.221.2.tar.gz</li></ol> <h2 id="解压"><a href="#解压" aria-hidden="true" class="header-anchor">#</a> 解压</h2> <p>将所有压缩包都解压，除了 <code>objc4-750.1</code> 外都放到一个文件夹 <code>source</code> 下。</p> <p><img src="/blog/assets/img/1.572f9f11.png" alt=""></p> <h2 id="编译"><a href="#编译" aria-hidden="true" class="header-anchor">#</a> 编译</h2> <h3 id="_1-创建-include-文件夹并设置-header-search-paths"><a href="#_1-创建-include-文件夹并设置-header-search-paths" aria-hidden="true" class="header-anchor">#</a> 1. 创建 <code>include</code> 文件夹并设置 Header Search Paths</h3> <p>进入 <code>objc4-750.1/</code>，创建一个文件夹 <code>include</code> 文件夹。</p> <p><img src="/blog/assets/img/2.9e65dc4d.png" alt=""></p> <p>在 <code>Build Settings</code> 中设置 <code>Header Search Paths</code>。 Debug 和 Release 都要修改。</p> <div class="language- extra-class"><pre class="language-text"><code>$(SRCROOT)/include
</code></pre></div><p><img src="/blog/assets/img/3.773c89ea.jpg" alt=""></p> <h3 id="_2-开始编译"><a href="#_2-开始编译" aria-hidden="true" class="header-anchor">#</a> 2. 开始编译</h3> <p>开始编译后会出现很多 error ，一个一个来解决它们。</p> <h4 id="_1-i386-error"><a href="#_1-i386-error" aria-hidden="true" class="header-anchor">#</a> 1. <code>i386 error</code></h4> <div class="language- extra-class"><pre class="language-text"><code>error: The i386 architecture is deprecated. You should update your ARCHS build setting to remove the i386 architecture. (in target 'objc-trampolines')
Build system information
error: The i386 architecture is deprecated. You should update your ARCHS build setting to remove the i386 architecture. (in target 'objc')
</code></pre></div><p>提示很明显，将 对应的 <code>TARGETS</code> -&gt; <code>Build Settings</code> -&gt; <code>Architectures</code> 都改为 <code>Standard Archiectures</code> 或者去除 i386 这种架构的支持。</p> <p><img src="/blog/assets/img/4.83f3d3b3.jpg" alt=""></p> <p>继续编译</p> <h4 id="_2-sys-reason-h-file-not-found"><a href="#_2-sys-reason-h-file-not-found" aria-hidden="true" class="header-anchor">#</a> 2. <code>'sys/reason.h' file not found</code></h4> <p>在 source 目录下搜索 reason.h</p> <h5 id="_1-通过-finder"><a href="#_1-通过-finder" aria-hidden="true" class="header-anchor">#</a> 1. 通过 Finder</h5> <p>通过 finder 在 <code>source/</code> 文件夹下搜索 <code>reason.h</code>。</p> <p><img src="/blog/assets/img/5.8160e8ab.jpg" alt=""></p> <h5 id="_2-通过终端搜索"><a href="#_2-通过终端搜索" aria-hidden="true" class="header-anchor">#</a> 2. 通过终端搜索</h5> <div class="language- extra-class"><pre class="language-text"><code>find . -name &quot;reason.h&quot;
</code></pre></div><p>这样会得到对应的路径</p> <div class="language- extra-class"><pre class="language-text"><code>./xnu-4903.221.2/bsd/sys/reason.h
</code></pre></div><p>根据编译错误我们可以看出 reason.h 文件在 sys 目录下面，因此我们在 include 目录下创建 sys 目录，并将 reason.h 放到该目录下。当然也可以通过命令行来实现，这里就不作细数了。</p> <p><img src="/blog/assets/img/6.f7621b4a.jpg" alt=""></p> <h4 id="_3-mach-o-dyld-priv-h-file-not-found"><a href="#_3-mach-o-dyld-priv-h-file-not-found" aria-hidden="true" class="header-anchor">#</a> 3. <code>'mach-o/dyld_priv.h' file not found</code></h4> <p>重复上面的操作，选择 <code>./dyld-551.4/include/mach-o/dyld_priv.h</code></p> <h4 id="_4-os-lock-private-h-file-not-found"><a href="#_4-os-lock-private-h-file-not-found" aria-hidden="true" class="header-anchor">#</a> 4. <code>'os/lock_private.h' file not found</code></h4> <p>选择 <code>./libplatform-177.200.16/private/os/lock_private.h</code></p> <h4 id="_5-os-base-private-h-file-not-found"><a href="#_5-os-base-private-h-file-not-found" aria-hidden="true" class="header-anchor">#</a> 5. <code>'os/base_private.h' file not found</code></h4> <p>选择 <code>./libplatform-177.200.16/private/os/base_private.h</code></p> <h4 id="_6-pthread-tsd-private-h-file-not-found"><a href="#_6-pthread-tsd-private-h-file-not-found" aria-hidden="true" class="header-anchor">#</a> 6. <code>'pthread/tsd_private.h' file not found</code></h4> <p>选择 <code>./libpthread-330.220.2/private/tsd_private.h</code></p> <h4 id="_7-system-machine-cpu-capabilities-h-file-not-found"><a href="#_7-system-machine-cpu-capabilities-h-file-not-found" aria-hidden="true" class="header-anchor">#</a> 7. <code>'System/machine/cpu_capabilities.h' file not found</code></h4> <p>这个搜索出来三个</p> <div class="language- extra-class"><pre class="language-text"><code>./xnu-4903.221.2/osfmk/i386/cpu_capabilities.h
./xnu-4903.221.2/osfmk/machine/cpu_capabilities.h
./xnu-4903.221.2/osfmk/arm/cpu_capabilities.h
</code></pre></div><p>根据目录名 <code>machine</code> 选择 <code>./xnu-4903.221.2/osfmk/machine/cpu_capabilities.h</code></p> <h4 id="_8-os-tsd-h-file-not-found"><a href="#_8-os-tsd-h-file-not-found" aria-hidden="true" class="header-anchor">#</a> 8. <code>'os/tsd.h' file not found</code></h4> <p>同样有两个</p> <div class="language- extra-class"><pre class="language-text"><code>./xnu-4903.221.2/libsyscall/os/tsd.h
./libdispatch-1008.200.78/src/shims/tsd.h
</code></pre></div><p>选择 <code>./xnu-4903.221.2/libsyscall/os/tsd.h</code></p> <h4 id="_9-pthread-spinlock-private-h-file-not-found"><a href="#_9-pthread-spinlock-private-h-file-not-found" aria-hidden="true" class="header-anchor">#</a> 9. <code>'pthread/spinlock_private.h' file not found</code></h4> <p>选择 <code>./libpthread-330.220.2/private/spinlock_private.h</code></p> <h4 id="_10-system-pthread-machdep-h-file-not-found"><a href="#_10-system-pthread-machdep-h-file-not-found" aria-hidden="true" class="header-anchor">#</a> 10. <code>'System/pthread_machdep.h' file not found</code></h4> <p>选择 <code>./Libc-825.40.1/pthreads/pthread_machdep.h</code></p> <h4 id="_11-crashreporterclient-h-file-not-found"><a href="#_11-crashreporterclient-h-file-not-found" aria-hidden="true" class="header-anchor">#</a> 11. <code>'CrashReporterClient.h' file not found</code></h4> <p>选择 <code>./Libc-825.40.1/include/CrashReporterClient.h</code></p> <p>添加进去之后依然报错，查看报错的位置在 <code>CrashReporterClient.h</code> 文件中，代码如下</p> <div class="language- extra-class"><pre class="language-text"><code>#ifdef LIBC_NO_LIBCRASHREPORTERCLIENT

/* Fake the CrashReporterClient API */
#define CRGetCrashLogMessage() 0
#define CRSetCrashLogMessage(x) /* nothing */

#else /* !LIBC_NO_LIBCRASHREPORTERCLIENT */

/* Include the real CrashReporterClient.h */

#include_next &lt;CrashReporterClient.h&gt;

#endif /* !LIBC_NO_LIBCRASHREPORTERCLIENT */

#endif /* _LIBC_CRASHREPORTERCLIENT_H */
</code></pre></div><p>这个错误发生在 <code>#include_next</code>，事实上我们并没 <code>CrashReporterClient</code> 这个库。所以需要改一下工程配置文件:
<code>Build Settings</code> -&gt; <code>Preprocessor Macros（Debug &amp; Release）</code>加入:</p> <div class="language- extra-class"><pre class="language-text"><code>LIBC_NO_LIBCRASHREPORTERCLIENT
</code></pre></div><p><img src="/blog/assets/img/7.e2f089e9.jpg" alt=""></p> <h4 id="_12-block-private-h-file-not-found"><a href="#_12-block-private-h-file-not-found" aria-hidden="true" class="header-anchor">#</a> 12. <code>'Block_private.h' file not found</code></h4> <p>找到三个</p> <div class="language- extra-class"><pre class="language-text"><code>./xnu-4903.221.2/libkern/libkern/Block_private.h
./libclosure-73/Block_private.h
./libdispatch-1008.200.78/src/BlocksRuntime/Block_private.h
</code></pre></div><p>通过对比选择了 <code>./libdispatch-1008.200.78/src/BlocksRuntime/Block_private.h</code>, 这个版本最新。</p> <h4 id="_13-objc-shared-cache-h-file-not-found"><a href="#_13-objc-shared-cache-h-file-not-found" aria-hidden="true" class="header-anchor">#</a> 13. <code>'objc-shared-cache.h' file not found</code></h4> <p>选择 <code>./dyld-551.4/include/objc-shared-cache.h</code></p> <h4 id="_14-typedef-redefinition-with-different-types-int-vs-volatile-osspinlock-aka-volatile-int"><a href="#_14-typedef-redefinition-with-different-types-int-vs-volatile-osspinlock-aka-volatile-int" aria-hidden="true" class="header-anchor">#</a> 14. <code>Typedef redefinition with different types ('int' vs 'volatile OSSpinLock' (aka 'volatile int'))</code></h4> <p>这是因为重复定义引起的，也就是我们引入的头文件中有重复定义的变量或者函数名称，因此我们在 <code>include</code> 目录下通过执行 <code>grep</code> 命令来查找重复的定义。</p> <div class="language- extra-class"><pre class="language-text"><code>grep -rne &quot;typedef.*pthread_lock_t” .
</code></pre></div><p>找到以下定义的位置</p> <div class="language- extra-class"><pre class="language-text"><code>./pthread/spinlock_private.h:59:typedef volatile OSSpinLock pthread_lock_t __deprecated_msg(&quot;Use &lt;os/lock.h&gt; instead&quot;);
./System/pthread_machdep.h:214:typedef int pthread_lock_t;
</code></pre></div><p>因此需要注释掉一个，而又由于 <code>pthread_machdep.h</code> 来自 <code>Libc-825.40.1</code>, 这是较老的版本，因此在这里最好注释掉它里面的定义。</p> <h4 id="_14-static-declaration-of-pthread-has-direct-tsd-follows-non-static-declaration"><a href="#_14-static-declaration-of-pthread-has-direct-tsd-follows-non-static-declaration" aria-hidden="true" class="header-anchor">#</a> 14. <code>Static declaration of '_pthread_has_direct_tsd' follows non-static declaration</code></h4> <p>这里有三个函数重复了</p> <div class="language- extra-class"><pre class="language-text"><code>_pthread_has_direct_tsd(void)
_pthread_getspecific_direct(unsigned long slot)
_pthread_setspecific_direct(unsigned long slot, void * val)
</code></pre></div><p>同样同过 <code>grep</code> 命令来查找，然后发现他们也都是在 <code>pthread_machdep.h</code> 中，因此注释掉它们。</p> <div class="language- extra-class"><pre class="language-text"><code>_pthread_has_direct_tsd(void) 在 Line 216 - 232
_pthread_getspecific_direct(unsigned long slot) 在 Line 243 - 264
_pthread_setspecific_direct(unsigned long slot, void * val) 在 Line 267 - 294
</code></pre></div><blockquote><p>经过上面这两次我们的修改，我们可以大概猜测到版本9XX后的Libc项目下的pthread相关代码，被苹果移到了libpthread项目了。（pthread_machdep.h来自Libc项目，tsd_private.h和spinlock_private.h来自libpthread项目）</p></blockquote> <p><a href="https://blog.csdn.net/wotors/article/details/52489464" target="_blank" rel="noopener noreferrer">原文<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="_15-use-of-undeclared-identifier-dyld-macosx-version-10-11"><a href="#_15-use-of-undeclared-identifier-dyld-macosx-version-10-11" aria-hidden="true" class="header-anchor">#</a> 15. <code>Use of undeclared identifier 'DYLD_MACOSX_VERSION_10_11'</code></h4> <p>在 dyld_priv.h 文件顶部加入一下宏：</p> <div class="language- extra-class"><pre class="language-text"><code>#define DYLD_MACOSX_VERSION_10_11 0x000A0B00
#define DYLD_MACOSX_VERSION_10_12 0x000A0C00
#define DYLD_MACOSX_VERSION_10_13 0x000A0D00
#define DYLD_MACOSX_VERSION_10_14 0x000A0E00
</code></pre></div><h4 id="_16-isa-h-file-not-found"><a href="#_16-isa-h-file-not-found" aria-hidden="true" class="header-anchor">#</a> 16. <code>'isa.h' file not found</code></h4> <p>通过查找你会发现 <code>isa.h</code> 是存在于 objc4 的项目中的，只不过没有引入工程。</p> <p><img src="/blog/assets/img/8.a3dd11d7.jpg" alt=""></p> <h4 id="_17-simple-h-file-not-found"><a href="#_17-simple-h-file-not-found" aria-hidden="true" class="header-anchor">#</a> 17. <code>'_simple.h' file not found</code></h4> <p>发现两个</p> <div class="language- extra-class"><pre class="language-text"><code>./Libc-825.40.1/gen/_simple.h
./libplatform-177.200.16/private/_simple.h
</code></pre></div><p>对比以后发现 <code>./libplatform-177.200.16/private/_simple.h</code>，较新，选择这个。</p> <h4 id="_18-libobjc-order"><a href="#_18-libobjc-order" aria-hidden="true" class="header-anchor">#</a> 18. <code>libobjc.order</code></h4> <div class="language- extra-class"><pre class="language-text"><code>ld: can't open order file: /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.14.sdk/AppleInternal/OrderFiles/libobjc.order
clang: error: linker command failed with exit code 1 (use -v to see invocation)
</code></pre></div><p><code>libobjc.order</code> 的路径错误，在 <code>objc4-750.1</code> 目录下通过 <code>find . -name &quot;libobjc.order&quot;</code> 查找结果如下</p> <div class="language- extra-class"><pre class="language-text"><code>./libobjc.order
</code></pre></div><p>因此我们修改下工程配置。<code>Build Settings</code> -&gt; <code>Linking</code> -&gt; <code>Order File</code>, 把 Debug 和 Release 下的 <code>$(SDKROOT)/AppleInternal/OrderFiles/libobjc.order</code> 都修改成 <code>libobjc.order</code>。</p> <p><img src="/blog/assets/img/9.20d69576.jpg" alt=""></p> <h4 id="_19-lcrashreporterclient"><a href="#_19-lcrashreporterclient" aria-hidden="true" class="header-anchor">#</a> 19. <code>-lCrashReporterClient</code></h4> <div class="language- extra-class"><pre class="language-text"><code>ld: library not found for -lCrashReporterClient
clang: error: linker command failed with exit code 1 (use -v to see invocation)
</code></pre></div><p>需去 <code>Build Settings</code> -&gt; <code>Linking</code> -&gt; <code>Other Linker Flags</code> 里删掉 <code>&quot;-lCrashReporterClient&quot;</code></p> <p><img src="/blog/assets/img/10.1f11bfa1.jpg" alt=""></p> <h4 id="_20-macosx-internal"><a href="#_20-macosx-internal" aria-hidden="true" class="header-anchor">#</a> 20. <code>macosx.internal</code></h4> <div class="language- extra-class"><pre class="language-text"><code>xcodebuild: error: SDK &quot;macosx.internal&quot; cannot be located.
xcrun: error: unable to find utility &quot;clang++&quot;, not a developer tool or in PATH
</code></pre></div><p>把 <code>Target-objc</code> 的 <code>Build Phases</code> -&gt; <code>Run Script(markgc)</code> 里的内容 <code>macosx.internal</code> 改为 <code>macosx</code>.</p> <p><img src="/blog/assets/img/11.a140f0fb.jpg" alt=""></p> <h4 id="_21-no-such-public-header-file-tmp-objc-dst-usr-include-objc-objectivec-apinotes"><a href="#_21-no-such-public-header-file-tmp-objc-dst-usr-include-objc-objectivec-apinotes" aria-hidden="true" class="header-anchor">#</a> 21. <code>no such public header file: '/tmp/objc.dst/usr/include/objc/ObjectiveC.apinotes'</code></h4> <p>需要把 <code>Target-objc</code> 的 <code>Build Settings</code> -&gt; <code>Other Text</code> -&gt; <code>Based InstallAPI Flags</code> 里的内容全部清除。</p> <p><img src="/blog/assets/img/12.8046a9d1.jpg" alt=""></p> <p>并且一定记得要把 <code>Text-Based InstallAPI Verification Model</code> 里的值改为 <code>Errors Only</code>.</p> <p><img src="/blog/assets/img/13.cf942ede.jpg" alt=""></p> <h3 id="警告的处理"><a href="#警告的处理" aria-hidden="true" class="header-anchor">#</a> 警告的处理</h3> <h4 id="_1-pthread-tsd-slot-pthread-self-macro-redefined"><a href="#_1-pthread-tsd-slot-pthread-self-macro-redefined" aria-hidden="true" class="header-anchor">#</a> 1. <code>'_PTHREAD_TSD_SLOT_PTHREAD_SELF' macro redefined</code></h4> <p>在 <code>pthread_machdep.h</code> 头文件中宏定义重复了：</p> <ul><li><code>_PTHREAD_TSD_SLOT_PTHREAD_SELF</code></li> <li><code>_PTHREAD_TSD_RESERVED_SLOT_COUNT</code></li> <li><code>__PTK_LIBC_TTYNAME_KEY</code></li> <li><code>LOCK_INIT</code></li> <li><code>LOCK_INITIALIZER</code></li></ul> <p>根据上面的经验这里选择把 <code>pthread_machdep.h</code> 文件中的宏定义注释掉。</p> <h4 id="_2-traditional-headermap-style"><a href="#_2-traditional-headermap-style" aria-hidden="true" class="header-anchor">#</a> 2. <code>Traditional headermap style</code></h4> <div class="language- extra-class"><pre class="language-text"><code>Traditional headermap style is no longer supported; please migrate to using separate headermaps and set 'ALWAYS_SEARCH_USER_PATHS' to NO. (in target 'objc-trampolines')
Traditional headermap style is no longer supported; please migrate to using separate headermaps and set 'ALWAYS_SEARCH_USER_PATHS' to NO. (in target 'objc')
</code></pre></div><p>在项目 <code>Target</code> -&gt; <code>objc-trampolines</code> 和 <code>objc</code> -&gt; <code>Build Settings</code> 下设置 <code>ALWAYS_SEARCH_USER_PATHS</code> 为 NO。</p> <p><img src="/blog/assets/img/14.4bc46a8c.jpg" alt=""></p> <h4 id="_3-objc-exception-mm-584-5-code-will-never-be-executed"><a href="#_3-objc-exception-mm-584-5-code-will-never-be-executed" aria-hidden="true" class="header-anchor">#</a> 3. <code>objc-exception.mm:584:5: Code will never be executed</code></h4> <p>把不会执行到的代码 <code>__builtin_trap();</code> 注释掉.</p> <h4 id="_4-objc-class-mm-558-33-possible-misuse-of-comma-operator-here"><a href="#_4-objc-class-mm-558-33-possible-misuse-of-comma-operator-here" aria-hidden="true" class="header-anchor">#</a> 4. <code>objc-class.mm:558:33: Possible misuse of comma operator here</code></h4> <p>根据提示修改。</p> <h2 id="调试"><a href="#调试" aria-hidden="true" class="header-anchor">#</a> 调试</h2> <p>经过上面的一系列修改项目就可以跑起来了，这时候新建一个 <code>target</code> ，选择 OS X 下的 <code>Command Line Tool</code> ，起个名字 <code>test</code>。</p> <p><img src="/blog/assets/img/15.a44f9d0f.jpg" alt=""></p> <p>然后在 <code>Build Phases</code> -&gt; <code>Target Dependencies</code>，把 <code>Target objc</code>加进来。</p> <p><img src="/blog/assets/img/16.cf80a17f.jpg" alt=""></p> <p>然后在 <code>main.m</code> 加入你想加的测试代码。</p> <div class="language- extra-class"><pre class="language-text"><code>#import &lt;Foundation/Foundation.h&gt;
#import &lt;objc/runtime.h&gt;
#import &lt;objc/message.h&gt;

int main(int argc, const char * argv[]) {
    @autoreleasepool {
        Class suprerClass = [NSObject class];
        Class someClass = objc_allocateClassPair(suprerClass, &quot;someClass&quot;, 0);
        objc_registerClassPair(someClass);
        id someInstance = [[someClass alloc] init];
        NSLog(@&quot;%@&quot;, someInstance);
    }
    return 0;
}
</code></pre></div><h2 id="统计"><a href="#统计" aria-hidden="true" class="header-anchor">#</a> 统计</h2> <p>需要加入的头文件及其目录如下</p> <div class="language- extra-class"><pre class="language-text"><code>./CrashReporterClient.h
./Block_private.h
./_simple.h
./pthread
./pthread/spinlock_private.h
./pthread/tsd_private.h
./System
./System/pthread_machdep.h
./System/machine
./System/machine/cpu_capabilities.h
./sys
./sys/reason.h
./os
./os/lock_private.h
./os/tsd.h
./os/base_private.h
./objc-shared-cache.h
./mach-o
./mach-o/dyld_priv.h
</code></pre></div><h2 id="杂项"><a href="#杂项" aria-hidden="true" class="header-anchor">#</a> 杂项</h2> <h3 id="_1-import-没有提示"><a href="#_1-import-没有提示" aria-hidden="true" class="header-anchor">#</a> 1. import 没有提示</h3> <p>这应该是 XCode 10 的问题，可以通过 <code>File</code> --&gt; <code>Workspace 或者 Project Settings</code> --&gt; <code>Build System</code> --&gt; <code>Legacy Build System</code> 来设置。</p> <p><img src="/blog/assets/img/17.6423c56e.jpg" alt=""></p> <h3 id="_2-某些库的头文件无法找到"><a href="#_2-某些库的头文件无法找到" aria-hidden="true" class="header-anchor">#</a> 2. 某些库的头文件无法找到</h3> <p>随着版本的更新，新版本可能就不能按照上面的进行处理了。</p> <p>这时候首先可以先 Google 一下缺失的头文件，大部分情况下都能直接找到源码的地址。实在没有找到就换低版本尝试。</p> <h2 id="参考"><a href="#参考" aria-hidden="true" class="header-anchor">#</a> 参考</h2> <ol><li><a href="https://blog.csdn.net/wotors/article/details/52489464" target="_blank" rel="noopener noreferrer">objc - 编译Runtime源码objc4-680<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.imooc.com/article/268031" target="_blank" rel="noopener noreferrer">最新Runtime源码objc4-750编译<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.jianshu.com/p/9e0fc8295c4b" target="_blank" rel="noopener noreferrer">Xcode 10 下如何创建可调试的objc4-723、objc4-750.1工程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/24/2019, 1:27:08 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.a54d2909.js" defer></script><script src="/blog/assets/js/2.fd76eafa.js" defer></script><script src="/blog/assets/js/4.068bd1c5.js" defer></script>
  </body>
</html>
