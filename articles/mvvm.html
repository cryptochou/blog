<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MVVM 实战 | 周小可</title>
    <meta name="description" content="实践不仅是检验真理的标准，而且是唯一的标准。">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.4a9e7301.css" as="style"><link rel="preload" href="/blog/assets/js/app.a54d2909.js" as="script"><link rel="preload" href="/blog/assets/js/2.fd76eafa.js" as="script"><link rel="preload" href="/blog/assets/js/22.85e5ef53.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.15308436.js"><link rel="prefetch" href="/blog/assets/js/11.a771847c.js"><link rel="prefetch" href="/blog/assets/js/12.feaf4627.js"><link rel="prefetch" href="/blog/assets/js/13.e37a4c0b.js"><link rel="prefetch" href="/blog/assets/js/14.de6f1bc3.js"><link rel="prefetch" href="/blog/assets/js/15.4427f88c.js"><link rel="prefetch" href="/blog/assets/js/16.9d3218d0.js"><link rel="prefetch" href="/blog/assets/js/17.d9d07dad.js"><link rel="prefetch" href="/blog/assets/js/18.c4b7480b.js"><link rel="prefetch" href="/blog/assets/js/19.4f9f264a.js"><link rel="prefetch" href="/blog/assets/js/20.06a48f5c.js"><link rel="prefetch" href="/blog/assets/js/21.4257293a.js"><link rel="prefetch" href="/blog/assets/js/23.0dfc6d99.js"><link rel="prefetch" href="/blog/assets/js/24.a433853c.js"><link rel="prefetch" href="/blog/assets/js/25.97f2b81e.js"><link rel="prefetch" href="/blog/assets/js/26.532cd082.js"><link rel="prefetch" href="/blog/assets/js/27.96db6f2e.js"><link rel="prefetch" href="/blog/assets/js/28.a1f6a8bc.js"><link rel="prefetch" href="/blog/assets/js/29.b2c2bd91.js"><link rel="prefetch" href="/blog/assets/js/3.98209718.js"><link rel="prefetch" href="/blog/assets/js/30.4ab75552.js"><link rel="prefetch" href="/blog/assets/js/31.a263582b.js"><link rel="prefetch" href="/blog/assets/js/32.434785d8.js"><link rel="prefetch" href="/blog/assets/js/33.73f26596.js"><link rel="prefetch" href="/blog/assets/js/34.c4fb3767.js"><link rel="prefetch" href="/blog/assets/js/35.e8ff9422.js"><link rel="prefetch" href="/blog/assets/js/36.0252fde3.js"><link rel="prefetch" href="/blog/assets/js/37.1e89f062.js"><link rel="prefetch" href="/blog/assets/js/38.d84daf6a.js"><link rel="prefetch" href="/blog/assets/js/39.9bf7e592.js"><link rel="prefetch" href="/blog/assets/js/4.068bd1c5.js"><link rel="prefetch" href="/blog/assets/js/40.9d39ea55.js"><link rel="prefetch" href="/blog/assets/js/41.42a663a1.js"><link rel="prefetch" href="/blog/assets/js/42.3a751d2f.js"><link rel="prefetch" href="/blog/assets/js/43.3a335356.js"><link rel="prefetch" href="/blog/assets/js/44.7d01f77e.js"><link rel="prefetch" href="/blog/assets/js/45.94380ee0.js"><link rel="prefetch" href="/blog/assets/js/46.c3daaae4.js"><link rel="prefetch" href="/blog/assets/js/47.0ef93bcd.js"><link rel="prefetch" href="/blog/assets/js/48.5b1a24b8.js"><link rel="prefetch" href="/blog/assets/js/49.c39c7fef.js"><link rel="prefetch" href="/blog/assets/js/5.bb18b958.js"><link rel="prefetch" href="/blog/assets/js/50.43f38f52.js"><link rel="prefetch" href="/blog/assets/js/51.fb3a6504.js"><link rel="prefetch" href="/blog/assets/js/52.d09c3b70.js"><link rel="prefetch" href="/blog/assets/js/53.06f6490b.js"><link rel="prefetch" href="/blog/assets/js/54.437f5d1a.js"><link rel="prefetch" href="/blog/assets/js/55.eb0681e9.js"><link rel="prefetch" href="/blog/assets/js/56.089548ed.js"><link rel="prefetch" href="/blog/assets/js/57.d545c4fe.js"><link rel="prefetch" href="/blog/assets/js/58.70be975f.js"><link rel="prefetch" href="/blog/assets/js/59.eebe4e88.js"><link rel="prefetch" href="/blog/assets/js/6.4d3dd8e5.js"><link rel="prefetch" href="/blog/assets/js/60.91b3ed77.js"><link rel="prefetch" href="/blog/assets/js/61.71e6c721.js"><link rel="prefetch" href="/blog/assets/js/62.28e384bf.js"><link rel="prefetch" href="/blog/assets/js/63.6646438b.js"><link rel="prefetch" href="/blog/assets/js/64.302d43d4.js"><link rel="prefetch" href="/blog/assets/js/65.271d4d28.js"><link rel="prefetch" href="/blog/assets/js/66.90a8840e.js"><link rel="prefetch" href="/blog/assets/js/67.1ad437d0.js"><link rel="prefetch" href="/blog/assets/js/68.90855765.js"><link rel="prefetch" href="/blog/assets/js/69.f6f5adc6.js"><link rel="prefetch" href="/blog/assets/js/7.481a6611.js"><link rel="prefetch" href="/blog/assets/js/70.3853662a.js"><link rel="prefetch" href="/blog/assets/js/71.98d8eeee.js"><link rel="prefetch" href="/blog/assets/js/72.fff2c9b2.js"><link rel="prefetch" href="/blog/assets/js/73.3d888aa9.js"><link rel="prefetch" href="/blog/assets/js/74.f4c59cfe.js"><link rel="prefetch" href="/blog/assets/js/75.39a7ef7e.js"><link rel="prefetch" href="/blog/assets/js/76.9faa10ae.js"><link rel="prefetch" href="/blog/assets/js/77.ac1b1239.js"><link rel="prefetch" href="/blog/assets/js/78.614fab51.js"><link rel="prefetch" href="/blog/assets/js/79.91b89113.js"><link rel="prefetch" href="/blog/assets/js/8.a7cdda78.js"><link rel="prefetch" href="/blog/assets/js/80.aaa67e21.js"><link rel="prefetch" href="/blog/assets/js/81.1e302fb8.js"><link rel="prefetch" href="/blog/assets/js/82.fce58955.js"><link rel="prefetch" href="/blog/assets/js/83.36cc12dd.js"><link rel="prefetch" href="/blog/assets/js/84.512f6776.js"><link rel="prefetch" href="/blog/assets/js/85.b32496e1.js"><link rel="prefetch" href="/blog/assets/js/86.f741c1ec.js"><link rel="prefetch" href="/blog/assets/js/87.29d27f1f.js"><link rel="prefetch" href="/blog/assets/js/88.3b0964ad.js"><link rel="prefetch" href="/blog/assets/js/89.12851ce5.js"><link rel="prefetch" href="/blog/assets/js/9.48986d07.js"><link rel="prefetch" href="/blog/assets/js/90.2f222f77.js"><link rel="prefetch" href="/blog/assets/js/91.edf5550b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.4a9e7301.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">周小可</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">iOS</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/gcd/" class="nav-link">GCD</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/locks/" class="nav-link">iOS中的锁</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/performance-optimization/" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/responder/" class="nav-link">事件响应</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/image_decode/" class="nav-link">图片编解码</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/nshashtable-nsmaptable/" class="nav-link">NSHashTable 和 NSMapTable</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/dttext/" class="nav-link">图文混排与 DTCoreText</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/mvvm/" class="nav-link">MVVM 实战</a></li><li class="dropdown-item"><!----> <a href="https://github.com/hnxczk/InfiniteTree" target="_blank" rel="noopener noreferrer" class="nav-link external">
  InfiniteTree
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/hnxczk/ScrollViewAutoAdjust" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ScrollViewAutoAdjust
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/blog/articles/instruments/" class="nav-link">Instruments 分析</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/note/" class="nav-link">笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/mdn/" class="nav-link">MDN 学习笔记</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/02/" class="nav-link">JavaScript 类型</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/03/" class="nav-link">JavaScript 对象和原型链</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/05/" class="nav-link">JavaScript 执行上下文和执行栈</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/06/" class="nav-link">JavaScript 作用域链与闭包</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/head-first-design-pattern/" class="nav-link">Head First 设计模式</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/Graphic-Design-Patterns/" class="nav-link">图说设计模式</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-algorithm/" class="nav-link">极客时间-算法</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/" class="nav-link">极客时间-重学前端</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/network-study/" class="nav-link">极客时间-网络</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">源码解析</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/sd/" class="nav-link">SDWebImage</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/runtime/index/" class="nav-link">Runtime</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/hash-map/" class="nav-link">哈希表</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/search/" class="nav-link">查找</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/algorithm-interview/" class="nav-link">面试遇到的算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/networking/" class="nav-link">哈希表</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/http-https/" class="nav-link">HTTP与HTTPS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/ios-coding-style/" class="nav-link">iOS 代码规范</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/ios-code-review/" class="nav-link">iOS 代码审核</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/configura/" class="nav-link">多环境配置</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/ios-app-on-line/" class="nav-link">开发者账号相关</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/uml/" class="nav-link">UML类图</a></li></ul></div></div> <a href="https://github.com/hnxczk/hnxczk.github.io.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">iOS</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/gcd/" class="nav-link">GCD</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/locks/" class="nav-link">iOS中的锁</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/performance-optimization/" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/responder/" class="nav-link">事件响应</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/image_decode/" class="nav-link">图片编解码</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/nshashtable-nsmaptable/" class="nav-link">NSHashTable 和 NSMapTable</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/dttext/" class="nav-link">图文混排与 DTCoreText</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/mvvm/" class="nav-link">MVVM 实战</a></li><li class="dropdown-item"><!----> <a href="https://github.com/hnxczk/InfiniteTree" target="_blank" rel="noopener noreferrer" class="nav-link external">
  InfiniteTree
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/hnxczk/ScrollViewAutoAdjust" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ScrollViewAutoAdjust
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/blog/articles/instruments/" class="nav-link">Instruments 分析</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/note/" class="nav-link">笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/mdn/" class="nav-link">MDN 学习笔记</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/02/" class="nav-link">JavaScript 类型</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/03/" class="nav-link">JavaScript 对象和原型链</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/05/" class="nav-link">JavaScript 执行上下文和执行栈</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/06/" class="nav-link">JavaScript 作用域链与闭包</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/head-first-design-pattern/" class="nav-link">Head First 设计模式</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/Graphic-Design-Patterns/" class="nav-link">图说设计模式</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-algorithm/" class="nav-link">极客时间-算法</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/reading-notes/geekbang-winter/" class="nav-link">极客时间-重学前端</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/network-study/" class="nav-link">极客时间-网络</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">源码解析</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/sd/" class="nav-link">SDWebImage</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/runtime/index/" class="nav-link">Runtime</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/hash-map/" class="nav-link">哈希表</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/search/" class="nav-link">查找</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/algorithm-interview/" class="nav-link">面试遇到的算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/networking/" class="nav-link">哈希表</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/http-https/" class="nav-link">HTTP与HTTPS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/ios-coding-style/" class="nav-link">iOS 代码规范</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/ios-code-review/" class="nav-link">iOS 代码审核</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/configura/" class="nav-link">多环境配置</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/ios-app-on-line/" class="nav-link">开发者账号相关</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/uml/" class="nav-link">UML类图</a></li></ul></div></div> <a href="https://github.com/hnxczk/hnxczk.github.io.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MVVM 实战</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/articles/mvvm.html#mvc" class="sidebar-link">MVC</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/articles/mvvm.html#mvvm" class="sidebar-link">MVVM</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mvvm-实战"><a href="#mvvm-实战" aria-hidden="true" class="header-anchor">#</a> MVVM 实战</h1> <p>首先我们知道 MVC 已经拥有将近 50 年的历史，是最出名并且应用最广泛的架构模式。至于后来的 MVVM, MVP 等架构模式都是在它基础之上发展出来的。因此我们先来大致了解（或者复习）下 MVC。</p> <h2 id="mvc"><a href="#mvc" aria-hidden="true" class="header-anchor">#</a> MVC</h2> <p>在 iOS 开发中，MVC 是苹果推荐的一个用来组织代码的权威范式,是构建iOS App的标准模式。按照 MVC 可以将整个应用分成 Model、View 和 Controller 三个部分。</p> <ul><li>视图（View）：负责渲染和展示内容，比如处理显示的字体间距位置等；</li> <li>模型（Model）：单纯的数据结构数据，一般用来承载服务器返回的数据；</li> <li>控制器（Controller）：负责控制视图和模型，比如管理视图的生命周期，发起网络请求获取模型数据，根据模型控制视图显示，处理用户交互等等。</li></ul> <p>下图是他们之间的依赖关系。</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>具体可以参考我写的一个 <a href="./code/mvvm/01_MVC">demo</a></p> <p>这个例子中主要模拟了一个常见的业务场景。从服务器获取数据并展示，然后当用户点击的时候处理点击事件，并修改数据然后展示修改后的界面。</p> <p>下面这是 Controller 里的部分代码。</p> <div class="language- extra-class"><pre class="language-text"><code>- (void)viewDidLoad
{
    [super viewDidLoad];
    [self.view addSubview:self.tableView];
    [self requestModel];
    [self.model addObserver:self forKeyPath:@&quot;countArray&quot; options:NSKeyValueObservingOptionNew | NSKeyValueObservingOptionInitial context:nil];
}

- (void)dealloc
{
    [self.model removeObserver:self forKeyPath:@&quot;countArray&quot;];
}

- (void)viewWillLayoutSubviews
{
    [super viewWillLayoutSubviews];
    self.tableView.frame = self.view.bounds;
}

- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context
{
    if ([keyPath isEqualToString:@&quot;countArray&quot;]) {
        self.title = [NSString stringWithFormat:@&quot;%ld&quot;, (long)self.model.totalCount];
        [self.tableView reloadData];
    }
}

- (NSInteger)tableView:(nonnull UITableView *)tableView numberOfRowsInSection:(NSInteger)section
{
    return self.model.countArray.count;
}

- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    TableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@&quot;TableViewCell&quot;];
    NSNumber *count = self.model.countArray[indexPath.row];
    [cell.countBtn setTitle:[NSString stringWithFormat:@&quot;%@&quot;, count] forState:UIControlStateNormal];
    __weak __typeof(self)weakSelf = self;
    cell.addClickBlock = ^{
        [weakSelf addActionAtIndex:indexPath.row];
    };
    return cell;
}

- (void)addActionAtIndex:(NSInteger)index
{
    NSNumber *count = self.model.countArray[index];
    NSInteger countInt = [count integerValue];
    NSMutableArray *countArray = [NSMutableArray arrayWithArray:self.model.countArray];
    countArray[index] = [NSNumber numberWithInteger:(countInt + 1)];
    self.model.countArray = countArray;
}

// 模拟网络请求
- (void)requestModel
{
    Model *model = [[Model alloc] init];
    NSMutableArray *array = [NSMutableArray array];
    for (int i = 0; i &lt; 10; i++) {
        [array addObject:@(i)];
        model.totalCount += i;
    }
    model.countArray = array;
    
    self.model = model;
}

- (UITableView *)tableView
{
    if (!_tableView) {
        _tableView = [[UITableView alloc] init];
        _tableView.delegate = self;
        _tableView.dataSource = self;
        _tableView.rowHeight = 50;
        [_tableView registerNib:[UINib nibWithNibName:@&quot;TableViewCell&quot; bundle:nil] forCellReuseIdentifier:@&quot;TableViewCell&quot;];
    }
    return _tableView;
}
</code></pre></div><p>在 demo 中 Controller 持有 View 和 Model。View 的交互事件通过 Block 传递到 Controller，然后控制器处理完业务逻辑后修改 Model。同时 Controller 通过 KVO 监听 Model 的改变后刷新界面。</p> <p>通过这个结构可以看出来 View 和 Model 层的责任较为单一，比较轻量。相应的 Controller 层的责任就比较复杂了。</p> <p>例子中 Controller 的职责（包括但不仅限于）：</p> <ul><li>管理根视图的生命周期和应用生命周期</li> <li>负责将视图层的 UIView 对象添加到持有的根视图上；</li> <li>负责处理用户行为，比如 UIButton 的点击；</li> <li>作为 UITableView 以及其它容器视图的代理以及数据源；</li> <li>负责 HTTP 请求的发起；</li> <li>处理业务逻辑</li></ul> <p>在加上 Cocoa Touch 框架中 UIViewController 类持有一个根视图 UIView，所以视图层与控制器层是紧密耦合在一起的，这也是 iOS 项目经常遇到视图控制器非常臃肿的重要原因之一。因此 iOS 的依赖关系往往会被视为下面这种</p> <p><img src="data:image/png;base64,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" alt=""></p> <h2 id="mvvm"><a href="#mvvm" aria-hidden="true" class="header-anchor">#</a> MVVM</h2> <p>相对于 MVC ， MVVM 最大的不同就是多抽象出来了一个 ViewModel 层。他们之间的依赖关系就变成了下图这样。</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>那什么东西是应该放入 ViewModel 呢？</p> <p>根据个人的经验来说网络请求，业务逻辑，处理转换模型等代码都可以放入其中。</p> <p>这是 <a href="./code/mvvm/02_MVVM">demo</a></p> <p>Controller</p> <div class="language- extra-class"><pre class="language-text"><code>- (void)viewDidLoad
{
    [super viewDidLoad];
    [self.view addSubview:self.tableView];
    [self.viewModel requestModel];
    
    [self.viewModel.model addObserver:self forKeyPath:@&quot;countArray&quot; options:NSKeyValueObservingOptionNew | NSKeyValueObservingOptionInitial context:nil];
}

- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context
{
    if ([keyPath isEqualToString:@&quot;countArray&quot;]) {
        self.title = [NSString stringWithFormat:@&quot;%ld&quot;, (long)self.viewModel.model.totalCount];
        [self.tableView reloadData];
    }
}

- (void)dealloc
{
    [self.viewModel.model removeObserver:self forKeyPath:@&quot;countArray&quot;];
}

- (void)viewWillLayoutSubviews
{
    [super viewWillLayoutSubviews];
    self.tableView.frame = self.view.bounds;
}

- (NSInteger)tableView:(nonnull UITableView *)tableView numberOfRowsInSection:(NSInteger)section
{
    return self.viewModel.model.countArray.count;
}

- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    TableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@&quot;TableViewCell&quot;];
    NSNumber *count = self.viewModel.model.countArray[indexPath.row];
    [cell.countBtn setTitle:[NSString stringWithFormat:@&quot;%@&quot;, count] forState:UIControlStateNormal];
    __weak __typeof(self)weakSelf = self;
    cell.addClickBlock = ^{
        [weakSelf.viewModel addActionAtIndex:indexPath.row];
    };
    return cell;
}

- (UITableView *)tableView
{
    if (!_tableView) {
        _tableView = [[UITableView alloc] init];
        _tableView.delegate = self;
        _tableView.dataSource = self;
        _tableView.rowHeight = 50;
        [_tableView registerNib:[UINib nibWithNibName:@&quot;TableViewCell&quot; bundle:nil] forCellReuseIdentifier:@&quot;TableViewCell&quot;];
    }
    return _tableView;
}

- (VIewModel *)viewModel
{
    if (!_viewModel) {
        _viewModel = [[VIewModel alloc] init];
    }
    return _viewModel;
}
</code></pre></div><p>ViewModel</p> <div class="language- extra-class"><pre class="language-text"><code>// 模拟网络请求
- (void)requestModel
{
    Model *model = [[Model alloc] init];
    NSMutableArray *array = [NSMutableArray array];
    for (int i = 0; i &lt; 10; i++) {
        [array addObject:@(i)];
        model.totalCount += i;
    }
    model.countArray = array;
    
    self.model = model;
}

- (void)addActionAtIndex:(NSInteger)index
{
    NSNumber *count = self.model.countArray[index];
    NSInteger countInt = [count integerValue];
    NSMutableArray *countArray = [NSMutableArray arrayWithArray:self.model.countArray];
    countArray[index] = [NSNumber numberWithInteger:(countInt + 1)];
    self.model.countArray = countArray;
}
</code></pre></div><p>这样以来业务代码基本上都在 ViewModel 中了。而在实际开发中业务的变化往往是变化最多的。这样以来后续的修改都被隔离在了 ViewModel 中。修改起来就比较方便了。</p> <p>通过上面我们可以看出来 MVVM 可以看成是一个 MVC 的增强版，因此它可以完全兼容 MVC ，可以很好的介入到项目中。</p> <p>另外需要注意的是 MVVM 配合一个绑定机制效果最好（比如大名鼎鼎的 ReactiveCocoa）。但是并不是说只能用 ReactiveCocoa 或者 RXSwift 来进行绑定。 我们可以结合使用 KVO 来做数据的同步。就像我在 demo 中的用法。当然了系统提供的 KVO 使用起来太过麻烦和危险，一般在项目中使用的都是 Facebook 开源的 FBKVOController 。当然也会有一些坑需要注意，可以参考我的<a href="/blog/articles/NSHashTable-NSMapTable.html">这篇</a>文章.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/24/2019, 1:27:08 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.a54d2909.js" defer></script><script src="/blog/assets/js/2.fd76eafa.js" defer></script><script src="/blog/assets/js/22.85e5ef53.js" defer></script>
  </body>
</html>
